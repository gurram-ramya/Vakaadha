<?xml version="1.0" encoding="UTF-8"?><sqlb_project><db path="" readonly="0" foreign_keys="" case_sensitive_like="" temp_store="" wal_autocheckpoint="" synchronous=""/><attached/><window><main_tabs open="structure browser pragmas query" current="3"/></window><tab_structure><column_width id="0" width="300"/><column_width id="1" width="0"/><column_width id="2" width="100"/><column_width id="3" width="4851"/><column_width id="4" width="0"/></tab_structure><tab_browse><table title="." custom_title="0" dock_id="2" table="0,0:"/><dock_state state="000000ff00000000fd00000001000000020000043c000002b6fc0100000002fb000000160064006f0063006b00420072006f007700730065003101000000000000043c0000000000000000fb000000160064006f0063006b00420072006f00770073006500320100000000ffffffff0000011800ffffff000002580000000000000004000000040000000800000008fc00000000"/><default_encoding codec=""/><browse_table_settings/></tab_browse><tab_sql><sql name="SQL 1*">-- =========================
-- USERS, PROFILES &amp; PREFERENCES
-- =========================
CREATE TABLE IF NOT EXISTS users (
  user_id       INTEGER PRIMARY KEY AUTOINCREMENT,
  firebase_uid  TEXT NOT NULL UNIQUE,
  email         TEXT UNIQUE,
  name          TEXT,
  is_admin      INTEGER NOT NULL DEFAULT 0,
  created_at    DATETIME NOT NULL DEFAULT (datetime('now')),
  updated_at    DATETIME NOT NULL DEFAULT (datetime('now')),
  last_login    DATETIME
);

CREATE TABLE IF NOT EXISTS user_profiles (
  profile_id    INTEGER PRIMARY KEY AUTOINCREMENT,
  user_id       INTEGER NOT NULL UNIQUE,
  dob           TEXT,
  gender        TEXT,
  avatar_url    TEXT,
  FOREIGN KEY(user_id) REFERENCES users(user_id) ON DELETE CASCADE
);

-- =========================
-- USER PREFERENCES
-- =========================
CREATE TABLE IF NOT EXISTS user_preferences (
  preference_id  INTEGER PRIMARY KEY AUTOINCREMENT,
  user_id        INTEGER NOT NULL,
  key            TEXT NOT NULL,
  value          TEXT,
  created_at     DATETIME NOT NULL DEFAULT (datetime('now')),
  updated_at     DATETIME NOT NULL DEFAULT (datetime('now')),
  FOREIGN KEY(user_id) REFERENCES users(user_id) ON DELETE CASCADE,
  UNIQUE(user_id, key)
);
CREATE INDEX IF NOT EXISTS idx_preferences_user ON user_preferences(user_id);

-- =========================
-- USER PAYMENT METHODS
-- =========================
CREATE TABLE IF NOT EXISTS user_payment_methods (
  payment_id     INTEGER PRIMARY KEY AUTOINCREMENT,
  user_id        INTEGER NOT NULL,
  provider       TEXT NOT NULL,               -- e.g., 'stripe', 'razorpay', 'paypal'
  token          TEXT NOT NULL,               -- opaque token from payment gateway
  last4          TEXT,                        -- last 4 digits for display
  expiry         TEXT,                        -- e.g. '12/27'
  is_default     INTEGER NOT NULL DEFAULT 0,
  created_at     DATETIME NOT NULL DEFAULT (datetime('now')),
  updated_at     DATETIME NOT NULL DEFAULT (datetime('now')),
  FOREIGN KEY(user_id) REFERENCES users(user_id) ON DELETE CASCADE
);
CREATE INDEX IF NOT EXISTS idx_payments_user ON user_payment_methods(user_id);
</sql><current_tab id="0"/></tab_sql></sqlb_project>
