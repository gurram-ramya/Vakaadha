<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>VAKAADHA</title>

  <!-- Styles -->
  <link rel="stylesheet" href="index.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Megrim&display=swap" rel="stylesheet"/>
  <script src="./navbar.js"></script>
</head>
<body>
  <!-- HEADER -->
  <header class="navbar">
    <a href="index.html" class="logo">VAKAADHA</a>
    <input type="checkbox" id="menu-toggle"/>
    <label for="menu-toggle" class="menu-icon">&#9776;</label>
    <nav class="nav-links">
      <a href="./index.html" aria-label="Home"><i class="fas fa-house"></i></a>
      <a href="./wishlist.html" aria-label="Wishlist">
        <i class="fas fa-heart"></i><span class="wishlist-count" id="wishlistCount">0</span>
      </a>
      <a href="./cart.html" aria-label="Cart">
        <i class="fas fa-shopping-cart"></i><span id="cartCount">0</span>
      </a>
      <div class="dropdown">
        <a href="./profile.html" aria-label="Profile">
          <i class="fas fa-user"></i> <span id="user-display"></span>
        </a>
        <div class="dropdown-content">
          <a href="profile.html" id="auth-link">Login / Signup</a>
          <div id="logged-in-links" class="hidden">
            <a href="orders.html">My Orders</a>
            <a href="wishlist.html">Wishlist</a>
            <a href="addresses.html">Addresses</a>
            <a href="#" id="logout">Logout</a>
          </div>
        </div>
      </div>
    </nav>
  </header>

  <!-- HERO -->
  <section class="hero-image-section">
    <div class="hero-content">
      <h1 class="hero-title">VAKAADHA</h1>
      <p class="hero-tagline">Made to be experienced, not explained</p>
    </div>
  </section>

  <!-- FEATURED PRODUCTS -->
  <section class="featured-products">
    <h2>Top Picks for You</h2>
    <div class="product-row" id="productGrid"></div>
  </section>

  <!-- Share Modal -->
  <div id="shareModal" class="modal" aria-hidden="true">
    <div class="modal-content">
      <button class="close" onclick="closeModal('shareModal')">&times;</button>
      <h2>Share this product</h2>
      <div class="share-options">
        <a id="share-whatsapp" target="_blank"><i class="fab fa-whatsapp"></i> WhatsApp</a>
        <a id="share-facebook" target="_blank"><i class="fab fa-facebook"></i> Facebook</a>
        <a id="share-twitter" target="_blank"><i class="fab fa-x-twitter"></i> Twitter/X</a>
        <button id="copy-link"><i class="fas fa-link"></i> Copy Link</button>
      </div>
    </div>
  </div>

  <!-- Scripts -->

    <!-- Scripts -->

    <script>
    function loadProducts() {
        fetch("/api/products")
        .then(res => res.json())
        .then(products => {
            const grid = document.getElementById("productGrid");
            grid.innerHTML = "";

            products.forEach(prod => {
            const price = "â‚¹" + (prod.price_cents / 100).toFixed(0);

            // Build sizes
            let sizesHtml = "";
            if (prod.variants && prod.variants.length > 0) {
                sizesHtml = `
                <div class="sizes">
                    ${prod.variants.map(v => `<button class="size-btn">${v.size}</button>`).join("")}
                </div>`;
            }

            const card = document.createElement("div");
            card.className = "product-card";
            card.innerHTML = `
                <div class="product-actions">
                <button class="wishlist-btn"><i class="far fa-heart"></i></button>
                <button class="share-btn"><i class="fas fa-share-alt"></i></button>
                </div>
                <img src="Images/${prod.image_url}" alt="${prod.name}">
                <h3>${prod.name}</h3>
                <p class="price">${price}</p>
                ${sizesHtml}
                <div class="card-actions">
                <button class="btn add-to-cart">Add to Cart</button>
                <button class="btn buy-now">Buy Now</button>
                </div>
            `;

            // attach handler here, with prod in closure
            card.querySelector(".add-to-cart").addEventListener("click", () => {
                let variant;
                const activeSize = card.querySelector(".size-btn.active");
                if (activeSize) {
                variant = prod.variants.find(v => v.size === activeSize.textContent);
                }

                if (prod.variants && prod.variants.length > 0) {
                if (!variant) variant = prod.variants[0];
                } else {
                alert("This product has no available variants");
                return;
                }

                addToCart(variant.variant_id, 1);
            });

            grid.appendChild(card);

            // size button toggle
            card.querySelectorAll(".size-btn").forEach(btn => {
                btn.addEventListener("click", () => {
                card.querySelectorAll(".size-btn").forEach(b => b.classList.remove("active"));
                btn.classList.add("active");
                });
            });
            });
        })
        .catch(err => console.error("Error loading products:", err));
    }

    document.addEventListener("DOMContentLoaded", () => {
        loadProducts();
        updateNavbarCounts();
    });
    </script>

    <script>
    // --- keep this as-is ---
    function getOrCreateGuestId() {
        let gid = localStorage.getItem("guest_id");
        if (!gid) {
        gid = crypto.randomUUID();
        localStorage.setItem("guest_id", gid);
        }
        return gid;
    }

    async function addToCart(variantId, quantity = 1) {
        const guestId = getOrCreateGuestId();
        try {
        const res = await fetch(`/api/cart?guest_id=${guestId}`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ variant_id: variantId, quantity })
        });
        if (!res.ok) throw new Error("Failed to add item");
        const cart = await res.json();
        console.log("Cart updated:", cart);
        alert("Item successfully added to cart!");
        updateNavbarCounts();
        } catch (err) {
        console.error("Add to cart error:", err);
        alert("Could not add to cart");
        }
    }

    // function refreshCartCount() {
    //     const guestId = localStorage.getItem("guest_id");
    //     if (!guestId) return;
    //     fetch(`/api/cart?guest_id=${guestId}`)
    //     .then(res => res.json())
    //     .then(data => {
    //         const badge = document.getElementById("cartCount");
    //         if (badge) badge.textContent = data.items.length;
    //     })
    //     .catch(err => console.error("Cart count error:", err));
    // }
    </script>





  <script src="./script.js"></script>
</body>
</html>
